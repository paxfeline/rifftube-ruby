(this.webpackJsonprifftube=this.webpackJsonprifftube||[]).push([[0],{124:function(e,t,a){},125:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(28),o=a.n(i),l=a(4),s=a(8),c=a(6),d=a(5),u=a(7),f=a(2),p=a(17),m=a(15),h=a.n(m),v="PLAY_MODE",E=function(e,t){return function(a){a({type:"SET_VIDEO_ID",payload:e}),t&&t.getAuthResponse&&(h()({method:"post",url:"/get-riffs",data:{token:t.getAuthResponse().id_token,videoID:e}}).then((function(e){a({type:"RECEIVE_RIFF_LIST",payload:e.data})})),h()({method:"post",url:"/get-view-riffs",data:{videoID:e}}).then((function(e){a({type:"RECEIVE_RIFF_META",payload:e.data})})))}},y=function(e){return{type:"SET_PLAYER_MODE",payload:e}},g=function(e,t,a){h()({method:"post",url:"/load-riff",responseType:"arraybuffer",data:{token:a?a.getAuthResponse().id_token:null,id:t}}).then((function(a){e({type:"RIFF_LOADED",payload:a.data,id:t})}))},b=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).componentDidMount=function(){var e=new Audio;e.controls=!1,e.src="/dingdong.wav",e.play().then((function(){console.log("playback ok"),a.setupAudioPlayers()})).catch((function(){console.log("playback not allowed")}))},a.setupAudioPlayers=function(){a.setState({allowed:!0}),window.audioContexts=[],window.audioPlayers=[],window.audioPlayerUse=[],window.audioPlayersCount=5;for(var e=0;e<5;e++){window.audioContexts[e]=new(window.AudioContext||window.webkitAudioContext),window.audioPlayers[e]=new Audio,window.audioPlayers[e].controls=!1,window.audioPlayers[e].addEventListener("ended",(function(){this.inUse=!1,console.log("riff finished")}));var t=document.createElement("source");window.audioPlayers[e].appendChild(t),window.audioPlayers[e].srcEl=t}},a.render=function(){return a.state?a.state.allowed?null:n.a.createElement("div",{className:"audio-capture",onClick:function(){a.setupAudioPlayers(),a.props.setPlayerMode(v)}}):null},a.state={allowed:!1},a}return Object(u.a)(t,e),t}(n.a.Component),w={setPlayerMode:y},R=Object(f.b)((function(e){return{}}),w)(b),I=function(e){function t(){var e,a;Object(l.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).componentDidMount=function(){if(window.YT&&window.YT.Player)a.loadVideo();else{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=a.loadVideo;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},a.loadVideo=function(){if(window.YT){var e=a.props.id;window.rifftubePlayer&&window.rifftubePlayer.destroy(),a.player=new window.YT.Player("rifftube-player",{videoId:e,height:390,width:640,playerVars:{playsinline:1},events:{onReady:a.onPlayerReady,onStateChange:a.onPlayerStateChange}}),window.rifftubePlayer=a.player}},a.onPlayerReady=function(e){},a.checkForRiffsToLoad=function(e){a.props.riffs.forEach((function(t){"audio"===t.type&&!t.payload&&!t.loading&&t.time>=e&&t.time<e+10&&a.props.loadRiff(t.id,a.props.googleUser)}))},a.onPlayerStateChange=function(e){1===e.data?(a.curRiff=a.props.riffsPlaying,a.riffInterval=setInterval((function(){var e=window.rifftubePlayer.getCurrentTime();window.metaPlayHead&&(window.metaPlayHead.current.style.left="".concat(e/a.props.duration*100,"%"),window.metaUpdate&&window.metaUpdate(window.metaPlayHead.current)),a.checkForRiffsToLoad(e),a.props.riffs.forEach((function(t,r){a.curRiff[r]&&(e<t.time||e>t.time+t.duration)&&(a.curRiff[r].inUse&&(a.curRiff[r].inUse=!1),a.props.setRiffPlaying(r,!1),a.curRiff[r]=null,"audio"===t.type&&a.audLock--,a.audLock||(window.rifftubePlayer.setVolume(a.vol?a.vol:100),delete a.vol))})),a.props.riffs.forEach((function(t,r){if(!a.curRiff[r]&&e>t.time&&e<t.time+.5&&(a.props.setRiffPlaying(r,!0),a.curRiff[r]=!0,"audio"===t.type)){if(a.vol||(a.vol=window.rifftubePlayer.getVolume(),window.rifftubePlayer.setVolume(.5*a.vol)),a.audLock?a.audLock++:a.audLock=1,!t.payload)return void console.log("empty payload error");var n=URL.createObjectURL(t.payload);window.lastRiff=t.payload;for(var i=0;i<window.audioPlayersCount;i++){var o=window.audioPlayers[i];if(!o.inUse){o.inUse=!0,o.srcEl.src=n,o.load(),o.play(),console.log("play riff! at ",i),a.curRiff[r]=o;break}}}}))}),100),a.props.mode!==v&&a.props.setPlayerMode(v)):(clearInterval(a.riffInterval),a.props.mode===v&&a.props.setPlayerMode("PAUSE_MODE"))},a.componentDidUpdate=function(e){a.checkForRiffsToLoad(0),a.props.id!==e.id&&a.loadVideo(),a.props.mode!==e.mode&&("EDIT_MODE"!==a.props.mode&&"EDIT_NEW_MODE"!==a.props.mode&&"PAUSE_MODE"!==a.props.mode||1!==a.player.getPlayerState()?a.props.mode===v&&1!==a.player.getPlayerState()&&a.player.playVideo():a.player.pauseVideo())},a.render=function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"rifftube-container"},n.a.createElement(R,null),n.a.createElement("div",{className:"rifftube-overlay"},n.a.createElement("div",{className:"rifftube-riffs-container"},Object.keys(a.props.riffsPlaying).filter((function(e){return a.props.riffsPlaying[e]&&a.props.riffs[e]&&"text"===a.props.riffs[e].type})).map((function(e){return n.a.createElement("div",{key:a.props.riffs[e].id,className:"rifftube-textriff"},a.props.riffs[e].payload)})))),n.a.createElement("div",{id:"rifftube-player"})))},a}return Object(u.a)(t,e),t}(n.a.Component),O={setPlayerMode:y,setRiffPlaying:function(e,t){return{type:t?"SET_RIFF_PLAYING":"SET_RIFF_NOT_PLAYING",payload:e}},togglePlayerMode:function(e){return{type:"TOGGLE_PLAYER_MODE"}},loadRiff:function(e,t){return function(a){g(a,e,t)}}},_=Object(f.b)((function(e){return{mode:e.mode,riffsPlaying:e.riffsPlaying,googleUser:e.googleUser,duration:e.duration}}),O)(I),D=a(53),T=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement(D.GoogleLogin,{socialId:"941154439836-s6iglcrdckcj6od74kssqsom58j96hd8.apps.googleusercontent.com",className:"google-login",scope:"profile email",fetchBasicProfile:!1,responseHandler:function(t){e.props.setGoogleUser(t,e.props.videoID)},buttonText:"Login With Google"})}}]),t}(n.a.Component),S={setGoogleUser:function(e,t){return function(a){a({type:"GOOGLE_USER_SIGNIN",payload:e}),h()({method:"post",url:"/get-riffs",data:{token:e.getAuthResponse().id_token,videoID:t}}).then((function(e){a({type:"RECEIVE_RIFF_LIST",payload:e.data})})),h()({method:"post",url:"/get-view-riffs",data:{videoID:t}}).then((function(e){a({type:"RECEIVE_RIFF_META",payload:e.data})}))}}},j=Object(f.b)((function(e){return{videoID:e.videoID}}),S)(T),k=a(54),A=a.n(k),F=a(55),P=a.n(F),C=a(56),N=a.n(C),x=a(57),U=a.n(x);var M={editRiff:function(e,t,a){return function(r){r({type:"EDIT_RIFF",payload:e}),t&&g(r,t,a)}},deleteRiff:function(e,t){return function(a){h()({method:"delete",url:"/riff-remove/".concat(e),data:{token:t.getAuthResponse().id_token}}).then((function(t){a({type:"DELETE_RIFF",id:e})}))}}},L=Object(f.b)((function(e){return{googleUser:e.googleUser}}),M)((function(e){return n.a.createElement("div",{className:"riff-detail".concat(e.selected?" riff-detail-selected":"")},n.a.createElement("div",null,n.a.createElement("ul",{className:"riff-detail-list"},"audio"===e.type?n.a.createElement("div",{className:"audio-icon"},n.a.createElement("img",{alt:"audio",src:N.a})):n.a.createElement("div",{className:"text-icon"},n.a.createElement("img",{alt:"text",src:U.a})),n.a.createElement("li",null,"start time: ",e.time.toFixed?e.time.toFixed(2):null),n.a.createElement("li",null,"duration: ",e.duration.toFixed(2),"secs")),n.a.createElement("div",{className:"edit-riff-buttons"},n.a.createElement("button",{className:"riff-button",onClick:function(){return e.editRiff(e.index,"audio"!==e.type||e.payload?null:e.id,e.googleUser)}},n.a.createElement("img",{alt:"edit button",src:P.a})),n.a.createElement("button",{className:"riff-button-delete",onClick:function(){window.confirm("Delete?")&&e.deleteRiff(e.id,e.googleUser)}},n.a.createElement("img",{alt:"delete button",src:A.a})))))}));var V=Object(f.b)((function(e){return{riffs:e.riffs.all,riffsPlaying:e.riffsPlaying}}),null)((function(e){return console.log("display",e.riffs),n.a.createElement("div",{className:"list-of-riffs"},e.riffs?e.riffs.sort((function(e,t){return e.time-t.time})).map((function(t,a){return n.a.createElement(L,Object.assign({key:t.id},t,{index:a,selected:!0===e.riffsPlaying[a]}))})):null)})),Y=a(32),G=a.n(Y),W=a(58),H=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={recorder:null,gumStream:null,recordingState:!1},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.setState({gumStream:t})})).catch((function(e){console.log("oops, can't get stream",e)}))}},{key:"render",value:function(){var e,t=this;return e=navigator.mediaDevices?this.state.recordingState?n.a.createElement("button",{id:"stopBtn",onClick:function(){t.setState({recordingState:!1}),t.duration=(Date.now()-t.startTime)/1e3,t.state.gumStream.getAudioTracks()[0].stop(),t.recorder.finishRecording(),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){t.setState({gumStream:e})})).catch((function(e){console.log("oops, can't get stream",e)}))}},"stop"):n.a.createElement("button",{id:"recordBtn",onClick:function(){t.setState({recordingState:!0}),t.startTime=Date.now();var e=(new(window.AudioContext||window.webkitAudioContext)).createMediaStreamSource(t.state.gumStream),a=new window.WebAudioRecorder(e,{workerDir:"/lib/",encoding:"mp3",onEncoderLoading:function(e,t){console.log("Loading "+t+" encoder...")},onEncoderLoaded:function(e,t){console.log(t+" encoder loaded")}});t.recorder=a,a.onComplete=function(e,a){console.log("Encoding complete"),t.props.saveTempAudio(a,t.duration)},a.setOptions({timeLimit:120,encodeAfterRecord:!0,mp3:{bitRate:160}}),console.log("Recording started"),a.startRecording()}},"Record"):n.a.createElement("span",null,"navigator.mediaDevices not supported. sorry."),n.a.createElement(n.a.Fragment,null,e)}}]),t}(n.a.Component),z=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).durationField=n.a.createRef(),a.htmlPayloadField=n.a.createRef(),a.startTimeField=n.a.createRef(),a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return console.log("ed rif red"),n.a.createElement("div",{className:"edit-riff"},n.a.createElement("div",{className:"edit-riff-inner"},"audio"===this.props.tempRiff.type?n.a.createElement(n.a.Fragment,null,"EDIT_MODE"===this.props.mode&&this.props.editIndex&&!this.props.tempRiff.payload?n.a.createElement("span",null,"Loading..."):null,n.a.createElement(H,{saveTempAudio:this.props.saveTempAudio}),this.props.tempRiff.payload?n.a.createElement("button",{onClick:Object(W.a)(G.a.mark((function t(){var a,r,n;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=document.createElement("audio"),r=document.createElement("source"),a.appendChild(r),a.controls=!1,n=URL.createObjectURL(e.props.tempRiff.payload),r.src=n,a.load(),a.play();case 9:case"end":return t.stop()}}),t)})))},"Play"):null,n.a.createElement("br",null),n.a.createElement("div",null,"Start:"," ",n.a.createElement("input",{id:"riff-start-field",defaultValue:this.props.tempRiff.time,ref:this.startTimeField})),n.a.createElement("button",{disabled:!this.props.tempRiff.payload,onClick:function(){e.props.saveRiff(e.props.googleUser.getAuthResponse().id_token,{payload:e.props.tempRiff.payload,time:Number(e.startTimeField.current.value)},e.props.tempRiff)}},"Save")):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"HTML payload:"),n.a.createElement("textarea",{id:"riff-edit-field",ref:this.htmlPayloadField,defaultValue:this.props.tempRiff.payload}),n.a.createElement("div",null,"Duration:"," ",n.a.createElement("input",{id:"riff-duration-field",defaultValue:this.props.tempRiff.duration||2,ref:this.durationField})),n.a.createElement("div",null,"Start:"," ",n.a.createElement("input",{id:"riff-start-field",defaultValue:this.props.tempRiff.time,ref:this.startTimeField})),n.a.createElement("button",{onClick:function(){e.props.saveRiff(e.props.googleUser.getAuthResponse().id_token,{payload:e.htmlPayloadField.current.value,duration:Number(e.durationField.current.value),time:Number(e.startTimeField.current.value)},e.props.tempRiff,e.props.websocket)}},"Save")),n.a.createElement("button",{onClick:function(){e.props.cancelEdit()}},"Cancel")))}}]),t}(n.a.Component),B={setPlayerMode:y,saveRiff:function(e,t,a,r){return function(n){n({type:"SAVE_RIFF",payload:t});var i=new FormData;i.append("token",e),i.append("text"===a.type?"text":"blob",t.payload),i.append("type",a.type),i.append("duration","text"===a.type?t.duration:a.duration),i.append("start_time",t.time),i.append("video_id",a.video_id),i.append("tempId",a.tempId),i.append("id",a.id),h()({method:"post",url:"/save-riff",data:i,headers:{"Content-Type":"multipart/form-data"}}).then((function(e){n({type:"SAVE_RIFF_SUCCESS",payload:e.data}),r.send(JSON.stringify({type:"update",video_id:a.video_id}))})).catch((function(e){n({type:"SAVE_RIFF_FAILURE",payload:e.response})}))}},saveTempAudio:function(e,t){return{type:"SAVE_TEMP_AUDIO",payload:e,duration:t}},cancelEdit:function(){return{type:"CANCEL_EDIT"}}},J=Object(f.b)((function(e){return{mode:e.mode,tempRiff:e.riffs.temp,editIndex:e.riffs.editIndex,googleUser:e.googleUser,websocket:e.websocket}}),B)(z),Q=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("button",{className:"riff-button",onClick:function(){e.props.createTempRiff(e.props.type,e.props.videoID)}},this.props.type)}}]),t}(n.a.Component),q={createTempRiff:function(e,t){return{type:"audio"===e?"CREATE_TEMP_AUDIO_RIFF":"CREATE_TEMP_TEXT_RIFF",videoID:t}}},X=Object(f.b)((function(e){return{videoID:e.videoID}}),q)(Q);var K={setRifferName:function(e,t){return function(a){h()({method:"post",url:"/set-name",data:{token:t.getAuthResponse().id_token,newName:e}}).then((function(e){a({type:"RECEIVE_NAME_UPDATE",payload:e.data})}))}}},Z=Object(f.b)((function(e){return{mode:e.mode,name:e.name,googleUser:e.googleUser}}),K)((function(e){return n.a.createElement("div",{className:"control-panel"},e.name?n.a.createElement("div",null,"Riffer Name:\xa0",e.name,n.a.createElement("button",{type:"button",onClick:function(){var t=prompt("Enter name",e.name);t&&e.setRifferName(t,e.googleUser)}},"Update Name")):null,n.a.createElement("div",null,n.a.createElement("h2",{className:"add-riff-title"},"Add New Riff"),n.a.createElement(X,{type:"audio"}),n.a.createElement(X,{type:"text"}),"EDIT_MODE"===e.mode||"EDIT_NEW_MODE"===e.mode?n.a.createElement(J,null):null),n.a.createElement("h2",{className:"riff-list-title"},"Control Panel"),n.a.createElement(V,null))})),$=function(e){function t(e){var a;return Object(l.a)(this,t),a=Object(c.a)(this,Object(d.a)(t).call(this,e)),window.metaPlayHead=n.a.createRef(),a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"container-riff-meta"},n.a.createElement("div",{id:"meta-play-head",ref:window.metaPlayHead}),this.props.riffsMeta&&this.props.duration&&this.props.riffs?this.props.riffsMeta.filter((function(t){return!e.props.riffs.find((function(e){return t.id===e.id}))})).map((function(t){return n.a.createElement("div",{className:"riff-meta",style:{left:t.time/e.props.duration*100+"%",width:t.duration/e.props.duration*100+"%"}})})):null,this.props.riffs?this.props.riffs.map((function(t){return n.a.createElement("div",{className:"riff-own-meta",style:{left:t.time/e.props.duration*100+"%",width:t.duration/e.props.duration*100+"%"}})})):null)}}]),t}(n.a.Component),ee=Object(f.b)((function(e){return{duration:e.duration,riffsMeta:e.riffsMeta,riffs:e.riffs.all}}),{})($),te=a(16);var ae=function(e){var t=e.color;return n.a.createElement("nav",{className:"navbar"},n.a.createElement(te.c,{style:{color:t},to:"/"},"Home"),n.a.createElement(te.c,{style:{color:t},to:"/riff"},"Start Riffing"),n.a.createElement(te.c,{style:{color:t},to:"/about"},"About"))},re=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).componentDidMount=function(){a.props.match.params.videoID&&(a.props.setVideoID(a.props.match.params.videoID,a.props.googleUser),a.videoIDRef.current.value=a.props.match.params.videoID)},a.componentDidUpdate=function(e,t){if(a.props.match.params.videoID!==a.props.videoID&&(a.props.setVideoID(a.props.match.params.videoID,a.props.googleUser),a.videoIDRef.current.value=a.props.match.params.videoID),a.loggedIn()&&(!a.state.websocket||a.props.videoID!==e.videoID)){var r=new WebSocket("".concat("wss://rifftube.herokuapp.com","/riff?videoID=").concat(a.props.match.params.videoID,"&googleToken=").concat(a.props.googleUser.getAuthResponse().id_token));r.onmessage=function(e){console.log(e.data)},a.props.setWebSocket(r)}},a.loggedIn=function(){return!!a.props.googleUser&&a.props.googleUser.isSignedIn()},a.authCheck=function(e,t){return a.loggedIn()?n.a.createElement(e,null):n.a.createElement(t,null)},a.extractVideoID=function(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return t&&11===t[7].length?t[7]:e},a.videoIDRef=n.a.createRef(),a.state={websocket:null},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return this.props.match.params.videoID?n.a.createElement(n.a.Fragment,null,n.a.createElement(ae,{color:"grey"}),n.a.createElement("div",{className:"youtube-section"},n.a.createElement("div",{className:"top-section"},n.a.createElement("div",{className:"title-and-url"},n.a.createElement("h1",null,"RiffTube"))),n.a.createElement("h4",{className:"get-started-instructions"},n.a.createElement(p.b,{exact:!0,path:"/riff/:videoID",render:function(){return e.loggedIn()?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(j,null)," ",n.a.createElement("p",null,"to get started"))}})),n.a.createElement("form",{onSubmit:function(t){var a=e.extractVideoID(e.videoIDRef.current.value);e.props.history.push("/riff/".concat(a)),e.props.setVideoID(a,e.props.googleUser),t.preventDefault()}},n.a.createElement("label",null,"Paste any YouTube URL here \u2192 "),n.a.createElement("input",{type:"text",defaultValue:this.props.videoID,ref:this.videoIDRef}),n.a.createElement("button",{className:"btn",id:"change-video-btn",type:"submit"},"Change Video")),n.a.createElement(_,{id:this.props.videoID,riffs:this.props.riffs}),n.a.createElement(ee,null),n.a.createElement("div",{className:"view-share-riff-link"},n.a.createElement("a",{href:"/view/"+this.props.videoID+(this.props.user_id?"?solo="+this.props.user_id:""),target:"_blank",rel:"noopener noreferrer"},"View & Share Riffed Video"))),n.a.createElement(p.b,{exact:!0,path:"/riff/:videoID",render:function(){return e.loggedIn()?n.a.createElement(Z,null):null}})):n.a.createElement(p.a,{to:"/riff/".concat(this.props.videoID)})}}]),t}(n.a.Component),ne={setVideoID:E,setWebSocket:function(e){return{type:"WEB_SOCKET_UPDATE",payload:e}}},ie=Object(f.b)((function(e){return{riffs:e.riffs.all,videoID:e.videoID,googleUser:e.googleUser,user_id:e.user_id}}),ne)(re),oe=a(12),le=a(22),se=a(3),ce=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).selectRiff=function(e){var t;if(!a.state.nonOverlappingRiffs.has(t)){var r=new Set(a.state.selectedRiffs),n=new Set(a.props.riffs),i=new Set;a.state.overlappingRiffs.forEach((function(e){return i.add(new Set(e))})),t=e;do{var o=!0,l=!1,s=void 0;try{for(var c,d=a.state.overlappingRiffs[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var u=c.value;u.has(t)&&u.forEach((function(e){r.delete(e),n.delete(e)}))}}catch(Q){l=!0,s=Q}finally{try{o||null==d.return||d.return()}finally{if(l)throw s}}r.add(t);var f=!0,p=!1,m=void 0;try{for(var h,v=r[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var E=h.value,y=[],g=!0,b=!1,w=void 0;try{for(var R,I=i[Symbol.iterator]();!(g=(R=I.next()).done);g=!0){var O=R.value;O.has(E)&&y.push(O)}}catch(Q){b=!0,w=Q}finally{try{g||null==I.return||I.return()}finally{if(b)throw w}}for(var _=0,D=y;_<D.length;_++){var T=D[_];i.delete(T);var S=new Set,j=!0,k=!1,A=void 0;try{for(var F,P=i[Symbol.iterator]();!(j=(F=P.next()).done);j=!0){var C=F.value,N=!0,x=!1,U=void 0;try{for(var M,L=T[Symbol.iterator]();!(N=(M=L.next()).done);N=!0){var V=M.value;n.delete(V),C.delete(V)}}catch(Q){x=!0,U=Q}finally{try{N||null==L.return||L.return()}finally{if(x)throw U}}}}catch(Q){k=!0,A=Q}finally{try{j||null==P.return||P.return()}finally{if(k)throw A}}}}}catch(Q){p=!0,m=Q}finally{try{f||null==v.return||v.return()}finally{if(p)throw m}}var Y=!0,G=!1,W=void 0;try{for(var H,z=i[Symbol.iterator]();!(Y=(H=z.next()).done);Y=!0){var B=H.value;B.size>0&&(S=new Set([].concat(Object(oe.a)(S),Object(oe.a)(B))))}}catch(Q){G=!0,W=Q}finally{try{Y||null==z.return||z.return()}finally{if(G)throw W}}S.size>0&&(t=S.values().next().value)}while(S.size>0);var J=[].concat(Object(oe.a)(n),Object(oe.a)(r));a.setState({filteredRiffs:J,selectedRiffs:r})}},window.metaPlayHead=n.a.createRef(),a.selectDiv=n.a.createRef(),window.metaUpdate=function(e){console.log(e.offsetLeft),a.selectDiv.current.scrollLeft=e.offsetLeft-a.selectDiv.current.offsetWidth/2},a.state={filteredRiffs:[],overlappingRiffs:[],nonOverlappingRiffs:null,selectedRiffs:null,tracks:[]},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){if(e.riffs!==this.props.riffs){var t=[[]],a=[0],r=new Set,n=[],i=[],o=new Set,l=0;this.props.riffs.sort((function(e,t){return e.time-t.time}));var s=!0,c=!1,d=void 0;try{for(var u,f=this.props.riffs[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value;if(n.length>0){var m=[],h=!0,v=!1,E=void 0;try{for(var y,g=n[Symbol.iterator]();!(h=(y=g.next()).done);h=!0){var b=y.value;if(b.time+b.duration<=p.time){if(l>0&&n.length>1){i.push(new Set(n));var w=!0,R=!1,I=void 0;try{for(var O,_=n[Symbol.iterator]();!(w=(O=_.next()).done);w=!0){var D=O.value;if(t[0].includes(D)){o.add(D);break}}}catch(L){R=!0,I=L}finally{try{w||null==_.return||_.return()}finally{if(R)throw I}}}else l>0&&r.add(b);m.push(b),l=-1}}}catch(L){v=!0,E=L}finally{try{h||null==g.return||g.return()}finally{if(v)throw E}}for(var T=0,S=m;T<S.length;T++){var j=S[T];n.splice(n.indexOf(j),1)}}n.push(p),n.sort((function(e,t){return e.time+e.duration-(t.time+t.duration)})),l=1;for(var k=!0,A=0;A<t.length;A++)if(a[A]<=p.time){t[A].push(p),a[A]=p.time+p.duration,k=!1;break}k&&(t.push([p]),a.push(p.time+p.duration))}}catch(L){c=!0,d=L}finally{try{s||null==f.return||f.return()}finally{if(c)throw d}}if(n.length>1){i.push(new Set(n));var F=!0,P=!1,C=void 0;try{for(var N,x=n[Symbol.iterator]();!(F=(N=x.next()).done);F=!0){var U=N.value;if(t[0].includes(U)){o.add(U);break}}}catch(L){P=!0,C=L}finally{try{F||null==x.return||x.return()}finally{if(P)throw C}}}else r.add(n[0]);var M=Object(oe.a)(t[0]);this.setState({filteredRiffs:M,overlappingRiffs:i,nonOverlappingRiffs:r,selectedRiffs:o,tracks:t})}}},{key:"render",value:function(){var e=this;return n.a.createElement(n.a.Fragment,null,n.a.createElement(_,{id:this.props.id,riffs:this.state.filteredRiffs}),n.a.createElement("div",{ref:this.selectDiv,style:{fontSize:"2em",overflow:"hidden",width:"640px"}},n.a.createElement("div",{style:{height:"".concat(.75*this.state.tracks.length,"em"),width:"".concat(this.props.duration,"em"),position:"relative"}},n.a.createElement("div",{id:"meta-play-head",style:{backgroundColor:"red",height:"inherit"},ref:window.metaPlayHead}),this.state.tracks.map((function(t){return n.a.createElement("div",{style:{width:"".concat(e.props.duration,"em"),height:"0.75em"}},t.map((function(t){return n.a.createElement("div",{style:{position:"absolute",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.25em",lineHeight:"3em",verticalAlign:"middle",left:"".concat(4*t.time,"em"),height:"3em",width:"".concat(4*t.duration,"em"),backgroundColor:e.state.filteredRiffs.includes(t)?"red":"lightgrey"},onClick:function(){return e.selectRiff(t)}},t.name)})))})))))}}]),t}(n.a.Component),de=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(d.a)(t).call(this,e))).setMute=function(e,t){a.setState((function(a,r){var n=Object(se.a)({},a.muted,Object(le.a)({},e,t));return{muted:n,filteredRiffs:r.riffs.filter((function(e){return!n[e.user_id]})),all:!1}}))},a.toggleMute=function(e){a.setMute(e,!a.state.muted[e])},a.state={names:[],muted:{},filteredRiffs:[],all:!0},a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e,t){var a=this;if(console.log(this.props),t.muted!==this.state.muted||t.all!==this.state.all)if(this.state.all)this.props.history.push("/view/".concat(this.props.videoID));else{var r=Object(se.a)({},this.state.muted),n="?solo="+this.state.names.map((function(e){return e.id})).filter((function(e){return!r[e]})).join(",");this.props.history.push("/view/".concat(this.props.videoID).concat(n))}if(e.timestamp!==this.props.timestamp||0===e.riffs.length&&this.props.riffs.length>0){var i=Object(oe.a)(this.state.names),o=this.props.riffers?this.props.riffers.indexOf(",")>=0?this.props.riffers.split(","):[this.props.riffers]:[],l=Object(se.a)({},this.state.muted);this.props.riffs.forEach((function(e){var t,r;t=i,r=e.user_id,t.some((function(e){return e.id===r}))||(i.push({name:e.name,id:e.user_id}),void 0!==a.props.riffers&&(l[e.user_id]=!o.some((function(t){return e.user_id===Number(t)}))))})),this.setState({names:i,muted:l,all:void 0===this.props.riffers,filteredRiffs:void 0===this.props.riffers?this.props.riffs:this.props.riffs.filter((function(e){return!l[e.user_id]}))})}}},{key:"render",value:function(){var e=this;return n.a.createElement(n.a.Fragment,null,n.a.createElement(ce,{id:this.props.videoID,duration:this.props.duration,riffs:this.state.filteredRiffs}),n.a.createElement("div",{onClick:function(){return e.setState({muted:{},all:!e.state.all,filteredRiffs:e.props.riffs})},style:{backgroundColor:this.state.all?"blue":"gray"}},"All"),this.state.names.map((function(t){return n.a.createElement("div",{key:t.id,onClick:function(){return e.toggleMute(t.id)},style:{backgroundColor:e.state.muted[t.id]?"gray":"blue"}},t.name)})))}}]),t}(n.a.Component),ue=Object(f.b)((function(e){return{timestamp:e.riffs.timestamp}}),null)(de),fe=a(90),pe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(a=Object(c.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).componentDidMount=function(){a.props.setVideoID(a.props.match.params.videoID),a.props.getViewRiffs(a.props.match.params.videoID)},a.render=function(){var e=fe.parse(a.props.location.search);return n.a.createElement(n.a.Fragment,null,n.a.createElement(ae,{color:"grey"}),n.a.createElement("div",{style:{marginTop:"4em"}},n.a.createElement("h1",null,"View ",a.props.match.params.videoID),n.a.createElement(ue,{duration:a.props.duration,history:a.props.history,videoID:a.props.match.params.videoID,riffers:e.solo,riffs:a.props.riffs})))},a}return Object(u.a)(t,e),t}(n.a.Component),me={setVideoID:E,getViewRiffs:function(e){return function(t){h()({method:"post",url:"/get-view-riffs",data:{videoID:e}}).then((function(e){t({type:"RECEIVE_RIFF_LIST",payload:e.data})}))}}},he=Object(f.b)((function(e){return{riffs:e.riffs.all,duration:e.duration}}),me)(pe),ve=a(60),Ee=a.n(ve),ye=a(26),ge=a.n(ye);var be=function(){return n.a.createElement("div",{className:"landing-page"},n.a.createElement(ae,{color:"grey"}),n.a.createElement("section",{className:"top-part"},n.a.createElement("div",{className:"heading"},n.a.createElement("span",{className:"heading-primary-main"},"RiffTube"),n.a.createElement("span",{className:"heading-primary-sub"},"Add Your Voice to YouTube Videos"),n.a.createElement(te.b,{to:"/riff",className:"get-started-btn btn"},"Get Started \u2192")),n.a.createElement("img",{alt:"movie theater",className:"movie-image",src:Ee.a})),n.a.createElement("section",{className:"middle-part"},n.a.createElement("div",{className:"middle-text"},n.a.createElement("h3",null,"Riffing for the Riff Raff")),n.a.createElement("div",{className:"features"},n.a.createElement("div",{className:"feature feature-one"},n.a.createElement(ge.a,{icon:"mic",color:"#a41320",size:"medium"}),n.a.createElement("p",null,"Record your voice")),n.a.createElement("div",{className:"feature feature-two"},n.a.createElement(ge.a,{icon:"edit",color:"#a41320",size:"medium"}),n.a.createElement("p",null,"Edit your recordings")),n.a.createElement("div",{className:"feature feature-three"},n.a.createElement(ge.a,{icon:"people",color:"#a41320",size:"medium"}),n.a.createElement("p",null,"Add your friends' voices")),n.a.createElement("div",{className:"feature feature-three"},n.a.createElement(ge.a,{icon:"share",color:"#a41320",size:"medium"}),n.a.createElement("p",null,"Share with anybody"))),n.a.createElement("div",{className:"about"},n.a.createElement("div",{className:"about-text"},n.a.createElement("h2",null,"About RiffTube"),n.a.createElement("p",null,"In the glorious tradition of Mystery Science Theater 3000, The Film Crew, RiffTrax, Cinematic Titanic, MST3k again, and others..."),n.a.createElement("p",null,"Now presenting: ",n.a.createElement("em",null,"you!")),n.a.createElement("p",null,"RiffTube allows you to add your own riffs to any video on YouTube.")))),n.a.createElement("section",{className:"bottom-part"},n.a.createElement("footer",{className:"landing-footer"},"Copyright \xa9 2020 - All rights reserved")))},we=a(61),Re=a.n(we);var Ie=function(){return n.a.createElement("div",{className:"landing-page"},n.a.createElement(ae,{color:"white"}),n.a.createElement("section",{className:"middle-part",style:{height:"initial"}},n.a.createElement("div",{className:"middle-text"},n.a.createElement("h3",null,"About RiffTube"),n.a.createElement("p",null,"or: How I Learned to Stop Worrying and Love RiffTube")),n.a.createElement("h2",null,"Developers:"),n.a.createElement("div",{className:"features"},n.a.createElement("div",{className:"feature feature-one",style:{width:"initial"}},n.a.createElement("img",{src:"/joss.jpg",alt:"Joss!",style:{borderRadius:"50%"}}),n.a.createElement("p",null,"Joscelyn!")),n.a.createElement("div",{className:"feature feature-two",style:{width:"initial"}},n.a.createElement("img",{src:"/david.jpg",alt:"David!",style:{borderRadius:"50%"}}),n.a.createElement("p",null,"David!"))),n.a.createElement("div",{className:"about",style:{backgroundColor:"white",width:"100%",color:"black"}},n.a.createElement("div",{className:"about-text"},n.a.createElement("h2",null,"Q&A"),n.a.createElement("p",null,"Q: Just what is RiffTube?"),n.a.createElement("p",null,"A: RiffTube is a tool that allows you to add your voice to YouTube videos. Riffs are saved remotely, so your riffs can be shared with the world!",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: How are you so smart that you came up with this and made it?"),n.a.createElement("p",null,"A: Years spent watching MST3k, and learning to code.",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: How can I contact you with questions or issues?"),n.a.createElement("p",null,"A: The best way to report technical issues is via the RiffTube"," ",n.a.createElement("a",{href:"https://github.com/JossWritesCode/RiffTube/issues"},"github repository")," ",n.a.createElement("a",{href:"https://github.com/JossWritesCode/RiffTube/issues"},"issue tracker"),n.a.createElement("br",null),"You can also email us:"," ",n.a.createElement("a",{href:"mailto:grokprogramming@gmail.com"},"grokprogramming@gmail.com"),".",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: It's not working!"),n.a.createElement("p",null,"A: If you have a Mac, check your Security & Privacy settings in System Preferences. You need to make sure that your browser has permission to access to microphone.",n.a.createElement("br",null),n.a.createElement("br",null),"If that doesn't help, please email us or report the issue via github. Please include what kind of computer you are using (Windows, Mac, Android, iOS, Linux, etc.), and what browser (Chrome, FireFox, Edge, etc).",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: Why is Google sign in required?"),n.a.createElement("p",null,"A: To identify specific users, and prevent abuse of the system. Your email address or other information will never be shared without your concept.",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: Do any YouTube videos not work?"),n.a.createElement("p",null,"A: Unfortunately, yes. Only videos that allow embedding currently work with RiffTube.",n.a.createElement("br",null)),n.a.createElement("div",{style:{height:"1px",background:"gray",width:"75%",margin:"auto"}}),n.a.createElement("p",null,"Q: Any plans?"),n.a.createElement("p",null,"A: So many. All the plans. If you have a feature you'd like to see, please submit a request. It might already be in the works!",n.a.createElement("br",null))),n.a.createElement("div",null,n.a.createElement("img",{alt:"people watching a movie",className:"horror-movie-image",src:Re.a})))),n.a.createElement("section",{className:"bottom-part"},n.a.createElement("footer",{className:"landing-footer"},"Copyright \xa9 2020 - All rights reserved")))},Oe=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return n.a.createElement(te.a,null,n.a.createElement("div",{className:"App"},n.a.createElement("div",{className:"main-section"},n.a.createElement(p.b,{exact:!0,path:"/",component:be}),n.a.createElement(p.b,{exact:!0,path:"/riff",component:ie}),n.a.createElement(p.b,{exact:!0,path:"/riff/:videoID",component:ie}),n.a.createElement(p.b,{exact:!0,path:"/about",component:Ie}),n.a.createElement(p.b,{exact:!0,path:"/view/:videoID",component:he}))))}}]),t}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var _e=a(20),De={all:[],temp:null,editIndex:null},Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_TEMP_AUDIO_RIFF":case"CREATE_TEMP_TEXT_RIFF":return Object(se.a)({},e,{temp:Object(se.a)({},e.temp,{type:"CREATE_TEMP_AUDIO_RIFF"===t.type?"audio":"text",time:window.rifftubePlayer.getCurrentTime(),video_id:t.videoID,tempId:(new Date).getUTCMilliseconds()}),editIndex:null});case"EDIT_RIFF":return Object(se.a)({},e,{temp:Object(se.a)({},e.all[t.payload]),editIndex:t.payload});case"DELETE_RIFF":var a=Object(se.a)({},e);return a.all=a.all.filter((function(e){return e.id!==t.id})),a;case"SAVE_TEMP_AUDIO":return Object(se.a)({},e,{temp:Object(se.a)({},e.temp,{duration:t.duration,payload:t.payload})});case"CANCEL_EDIT":return Object(se.a)({},e,{temp:null,editIndex:null});case"RECEIVE_RIFF_LIST":return Object(se.a)({},e,{timestamp:t.payload.timestamp,all:t.payload.body.map((function(e){return Object(se.a)({},e,{time:e.start_time,payload:e.isText?e.text:null,type:e.isText?"text":"audio"})}))});case"SAVE_RIFF_SUCCESS":if("add"===t.payload.type){var r=Object(oe.a)(e.all);r.forEach((function(e,a,r){e.tempId===t.payload.tempId&&(r[a]=Object(se.a)({},e,{id:t.payload.id}))}));var n=Object(se.a)({},e,{all:r});return n}return e;case"SAVE_RIFF":var i,o=Object(se.a)({},e.temp,{},t.payload);return null===e.editIndex?i=[].concat(Object(oe.a)(e.all),[o]):(i=Object(oe.a)(e.all))[e.editIndex]=o,{all:i,temp:null,editIndex:null};case"LOAD_RIFF":var l=Object(se.a)({},e);return l.all[t.payload].loading=!0,l;case"RIFF_LOADED":var s=new Blob(new Array(t.payload),{type:"audio/mp3"}),c=Object(oe.a)(e.all);c.forEach((function(e){e.id===t.id&&(e.payload=s,e.loading=!1)}));var d=Object(se.a)({},e,{all:c});return null!==e.editIndex&&e.temp.id===t.id&&(d.temp=Object(se.a)({},d.temp,{payload:s})),d;default:return e}},Se=[],je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_RIFF_META":return t.payload.body.map((function(e){return Object(se.a)({},e,{time:e.start_time,payload:e.isText?e.text:null,type:e.isText?"text":"audio"})}));default:return e}},ke=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PAUSE_MODE",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VIDEO_ID":return"PAUSE_MODE";case"CREATE_TEMP_AUDIO_RIFF":case"CREATE_TEMP_TEXT_RIFF":case"EDIT_RIFF":return"EDIT_MODE";case"SET_PLAYER_MODE":return t.payload;case"CANCEL_EDIT":return"PAUSE_MODE";case"TOGGLE_PLAYER_MODE":return e.mode===v?"PAUSE_MODE":v;case"SAVE_RIFF":return v;default:return e}},Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GOOGLE_USER_SIGNIN":return t.payload;default:return e}},Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VIDEO_ID":return{};case"SET_RIFF_PLAYING":case"SET_RIFF_NOT_PLAYING":return Object(se.a)({},e,Object(le.a)({},t.payload,"SET_RIFF_PLAYING"===t.type));default:return e}},Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_NAME_UPDATE":case"RECEIVE_RIFF_LIST":return t.payload.name||"";default:return e}},Ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_RIFF_LIST":return t.payload.user_id||0;default:return e}},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zZvmWtx_pfU",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_VIDEO_ID":return t.payload;default:return e}},xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_RIFF_LIST":case"SAVE_RIFF_SUCCESS":return console.log("video duration reducer",t),t.payload.duration?t.payload.duration:e;default:return e}},Ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"WEB_SOCKET_UPDATE":return t.payload;default:return e}},Me=Object(_e.c)({riffs:Te,riffsMeta:je,mode:ke,googleUser:Ae,riffsPlaying:Fe,name:Pe,user_id:Ce,videoID:Ne,duration:xe,websocket:Ue}),Le=(a(124),a(62)),Ve=Object(_e.d)(Me,Object(_e.a)(Le.a));o.a.render(n.a.createElement(f.a,{store:Ve},n.a.createElement(Oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},54:function(e,t,a){e.exports=a.p+"static/media/delete-24px.2fc9a828.svg"},55:function(e,t,a){e.exports=a.p+"static/media/edit-24px.94f6e29d.svg"},56:function(e,t,a){e.exports=a.p+"static/media/settings_voice-24px.62e607b7.svg"},57:function(e,t,a){e.exports=a.p+"static/media/chat-24px.190e0f49.svg"},60:function(e,t,a){e.exports=a.p+"static/media/undraw_movie_night_93wl.bd90a236.svg"},61:function(e,t,a){e.exports=a.p+"static/media/undraw_horror_movie_3988.a8de6ac3.svg"},63:function(e,t,a){e.exports=a(125)}},[[63,1,2]]]);
//# sourceMappingURL=main.c05e0359.chunk.js.map